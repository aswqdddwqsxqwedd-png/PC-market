# Руководство по внесению вклада в проект

Спасибо за интерес к проекту PC Place! Мы рады вашему желанию внести вклад. Это руководство поможет вам начать работу.

## Содержание

- [Код поведения](#код-поведения)
- [Как внести вклад](#как-внести-вклад)
- [Настройка окружения разработки](#настройка-окружения-разработки)
- [Структура проекта](#структура-проекта)
- [Стандарты кодирования](#стандарты-кодирования)
- [Процесс разработки](#процесс-разработки)
- [Тестирование](#тестирование)
- [Создание Pull Request](#создание-pull-request)

## Код поведения

Проект следует принципам открытого и дружелюбного сообщества. Мы ожидаем, что все участники будут:

- Быть уважительными и профессиональными
- Принимать конструктивную критику
- Фокусироваться на том, что лучше для сообщества
- Проявлять эмпатию к другим участникам

## Как внести вклад

### Типы вкладов

Мы приветствуем различные типы вкладов:

- **Исправление багов**: найдите и исправьте ошибки в коде
- **Новые функции**: предложите и реализуйте новые возможности
- **Улучшение документации**: улучшите README, комментарии, docstrings
- **Оптимизация**: улучшите производительность или структуру кода
- **Тесты**: добавьте тесты для существующего или нового функционала

### Сообщение о проблемах

Перед созданием issue:

1. Проверьте, не была ли проблема уже зарегистрирована
2. Убедитесь, что используете последнюю версию проекта
3. Соберите информацию о проблеме:
   - Версия Python
   - Версии зависимостей
   - Шаги для воспроизведения
   - Ожидаемое и фактическое поведение
   - Логи ошибок (если есть)

## Настройка окружения разработки

### Требования

- Python 3.10 или выше
- pip
- Git

### Установка

1. **Форкните репозиторий** на GitHub

2. **Клонируйте ваш форк**:
```bash
git clone https://github.com/your-username/pc-place.git
cd pc-place
```

3. **Создайте виртуальное окружение**:
```bash
python -m venv venv

# Windows
venv\Scripts\activate

# Linux/Mac
source venv/bin/activate
```

4. **Установите зависимости**:
```bash
pip install -r requirements.txt
```

5. **Настройте переменные окружения**:
Создайте файл `.env` в корне проекта:
```env
APP_NAME=PC Place
DEBUG=True
DATABASE_URL=sqlite+aiosqlite:///./pc_place.db
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

6. **Запустите приложение**:
```bash
uvicorn app.main:app --reload
```

7. **Проверьте работу**:
- Откройте http://localhost:8000
- Проверьте API документацию: http://localhost:8000/docs

## Структура проекта

```
pc-place/
├── app/
│   ├── api/              # API роуты (endpoints)
│   │   ├── auth.py       # Аутентификация
│   │   ├── categories.py # Категории
│   │   ├── items.py      # Товары
│   │   ├── cart.py       # Корзина
│   │   ├── orders.py     # Заказы
│   │   ├── admin.py      # Админ-панель
│   │   └── deps.py       # Зависимости (dependencies)
│   ├── core/             # Ядро приложения
│   │   ├── config.py     # Конфигурация
│   │   ├── security.py   # JWT, хеширование паролей
│   │   └── exceptions.py # Обработка ошибок
│   ├── db/               # База данных
│   │   └── database.py   # SQLAlchemy настройки
│   ├── models/           # SQLAlchemy модели
│   │   ├── user.py
│   │   ├── category.py
│   │   ├── item.py
│   │   ├── cart.py
│   │   ├── order.py
│   │   └── message.py
│   ├── schemas/          # Pydantic схемы (валидация)
│   │   ├── user.py
│   │   ├── category.py
│   │   ├── item.py
│   │   ├── cart.py
│   │   ├── order.py
│   │   └── message.py
│   ├── services/         # Бизнес-логика
│   │   ├── user_service.py
│   │   ├── item_service.py
│   │   ├── cart_service.py
│   │   ├── order_service.py
│   │   └── category_service.py
│   └── main.py           # Точка входа FastAPI
├── static/               # Статические файлы
│   ├── index.html        # Основное React SPA
│   ├── admin.html        # Админ-панель
│   └── seller.html       # Панель продавца
├── tests/                # Тесты
│   ├── test_*.py         # Основные тесты
│   ├── test_*_extended.py # Расширенные тесты
│   ├── test_*_quick.py   # Быстрые тесты для покрытия
│   └── conftest.py       # Pytest фикстуры
├── alembic/              # Миграции базы данных
├── .github/              # GitHub Actions CI/CD
│   └── workflows/
│       └── ci.yml        # CI конфигурация
├── requirements.txt      # Зависимости Python
├── pytest.ini            # Конфигурация pytest и coverage
├── .env                  # Переменные окружения (не в git)
└── README.md
```

### Архитектурные принципы

- **API Layer** (`app/api/`): Обрабатывает HTTP запросы, валидацию входных данных
- **Service Layer** (`app/services/`): Содержит бизнес-логику, изолированную от API
- **Data Layer** (`app/models/`, `app/schemas/`): Модели данных и валидация
- **Core Layer** (`app/core/`): Общие утилиты, конфигурация, безопасность

## Стандарты кодирования

### Python

- Следуйте [PEP 8](https://www.python.org/dev/peps/pep-0008/)
- Используйте type hints для всех функций
- Максимальная длина строки: 100 символов
- Используйте `black` для форматирования (если настроен)
- Используйте `isort` для сортировки импортов

### Именование

- **Функции и переменные**: `snake_case`
- **Классы**: `PascalCase`
- **Константы**: `UPPER_SNAKE_CASE`
- **Приватные методы**: начинаются с `_`

### Документация

- Используйте docstrings для всех функций и классов
- Формат docstrings: Google style
- Комментируйте сложную логику

Пример:
```python
def get_user_by_id(user_id: int, db: AsyncSession) -> User | None:
    """
    Получить пользователя по ID.
    
    Args:
        user_id: ID пользователя
        db: Сессия базы данных
        
    Returns:
        Объект User или None, если не найден
    """
    ...
```

### Импорты

Организуйте импорты в следующем порядке:
1. Стандартная библиотека Python
2. Сторонние библиотеки
3. Локальные импорты приложения

```python
# Стандартная библиотека
from typing import Optional
import asyncio

# Сторонние библиотеки
from fastapi import APIRouter, Depends
from sqlalchemy.ext.asyncio import AsyncSession

# Локальные импорты
from app.models import User
from app.schemas import UserCreate
from app.db import get_db
```

## Процесс разработки

### 1. Создание ветки

Всегда создавайте новую ветку для вашей работы:

```bash
# Обновите main ветку
git checkout main
git pull upstream main

# Создайте новую ветку
git checkout -b feature/your-feature-name
# или
git checkout -b fix/bug-description
```

### 2. Внесение изменений

- Делайте небольшие, логически связанные коммиты
- Пишите понятные сообщения коммитов
- Формат: `тип: краткое описание`

Типы коммитов:
- `feat`: новая функция
- `fix`: исправление бага
- `docs`: изменения в документации
- `style`: форматирование кода
- `refactor`: рефакторинг
- `test`: добавление тестов
- `chore`: обновление зависимостей, конфигурации

Примеры:
```
feat: добавлена фильтрация товаров по цене
fix: исправлена ошибка при добавлении в корзину
docs: обновлен README с инструкциями по установке
```

### 3. Проверка кода

Перед коммитом убедитесь, что:

- Код соответствует стандартам проекта
- Все импорты корректны
- Нет синтаксических ошибок
- Приложение запускается без ошибок
- API endpoints работают корректно

### 4. Тестирование

Перед коммитом обязательно запустите тесты:

```bash
# Запустите все тесты с проверкой покрытия
pytest --cov=app --cov-report=term --cov-fail-under=81

# Если тесты проходят, запустите сервер для ручного тестирования
uvicorn app.main:app --reload

# Проверьте API документацию
# Откройте http://localhost:8000/docs

# Протестируйте функционал вручную:
# - http://localhost:8000 - основное приложение
# - http://localhost:8000/admin.html - админ-панель
# - http://localhost:8000/seller.html - панель продавца
```

## Тестирование

### Ручное тестирование

1. **Аутентификация**:
   - Регистрация нового пользователя
   - Вход в систему
   - Получение текущего пользователя

2. **Товары**:
   - Просмотр списка товаров
   - Фильтрация и поиск
   - Создание товара (продавец/админ)
   - Обновление товара

3. **Корзина**:
   - Добавление товара
   - Изменение количества
   - Удаление товара

4. **Заказы**:
   - Создание заказа из корзины
   - Просмотр списка заказов
   - Изменение статуса заказа

5. **Админ-панель**:
   - Просмотр статистики
   - Управление пользователями
   - Управление товарами и заказами
   - Просмотр отчетов

6. **Панель продавца**:
   - Создание и редактирование товаров
   - Просмотр своих товаров
   - Управление заказами по своим товарам

7. **Чат и поддержка**:
   - Отправка сообщений
   - Подключение к поддержке
   - Общение по заказам
   - WebSocket для real-time обновлений

### Автоматические тесты

Проект использует pytest для автоматического тестирования. Требуется покрытие кода **81%+**.

```bash
# Запуск всех тестов
pytest

# Запуск с покрытием (терминал)
pytest --cov=app --cov-report=term

# Запуск с покрытием (HTML отчет)
pytest --cov=app --cov-report=html
# Откройте htmlcov/index.html в браузере

# Запуск с покрытием (XML для CI/CD)
pytest --cov=app --cov-report=xml --cov-report=term

# Запуск с проверкой минимального покрытия (81%)
pytest --cov=app --cov-report=xml --cov-report=term --cov-fail-under=81

# Запуск конкретного теста
pytest tests/test_auth.py

# Запуск конкретного теста с подробным выводом
pytest tests/test_auth.py -v

# Запуск только новых тестов (для быстрой проверки)
pytest tests/test_*_quick.py tests/test_coverage_boost.py -v
```

#### Структура тестов

- `test_*.py` - Основные тесты для каждого модуля
- `test_*_extended.py` - Расширенные тесты с дополнительными сценариями
- `test_*_quick.py` - Быстрые тесты для повышения покрытия кода
- `test_coverage_boost.py` - Дополнительные тесты для достижения целевого покрытия

#### Покрытие кода

Покрытие кода отслеживается через [Codecov](https://codecov.io). 

**Исключенные из покрытия файлы** (некритичные утилиты):
- `app/core/cache.py` - Кэширование (не используется в продакшене)
- `app/core/security_utils.py` - Дополнительные утилиты безопасности
- `app/utils/query_analyzer.py` - Анализатор запросов (не используется)
- `app/utils/__init__.py` - Пустой файл
- `app/core/logging.py` - Логирование (низкий приоритет)
- `app/services/notification_service.py` - Уведомления (низкий приоритет)

**Текущее покрытие**: 81%+ (проверяется в CI/CD)

#### CI/CD

Проект использует GitHub Actions для автоматического тестирования:
- Автоматический запуск тестов при push и pull request
- Проверка покрытия кода (минимум 81%)
- Загрузка отчетов в Codecov
- Сборка Docker образа

См. `.github/workflows/ci.yml` для деталей.

## Создание Pull Request

### Перед созданием PR

1. **Обновите вашу ветку**:
```bash
git checkout main
git pull upstream main
git checkout your-branch
git rebase main
```

2. **Убедитесь, что код работает**:
   - Приложение запускается
   - Нет ошибок в консоли
   - Функционал работает как ожидается

3. **Обновите документацию**:
   - Если добавляете новую функцию, обновите README
   - Добавьте комментарии к коду, если необходимо

### Создание PR

1. **Отправьте вашу ветку**:
```bash
git push origin your-branch
```

2. **Создайте Pull Request на GitHub**:
   - Перейдите на страницу репозитория
   - Нажмите "New Pull Request"
   - Выберите вашу ветку
   - Заполните описание

3. **Описание PR должно включать**:
   - Что изменено и зачем
   - Как протестировать изменения
   - Скриншоты (если применимо)
   - Связанные issues (если есть)

### Шаблон описания PR

```markdown
## Описание
Краткое описание изменений

## Тип изменений
- [ ] Исправление бага
- [ ] Новая функция
- [ ] Изменение документации
- [ ] Рефакторинг

## Как протестировать
1. Шаг 1
2. Шаг 2
3. Ожидаемый результат

## Чеклист
- [ ] Код следует стандартам проекта
- [ ] Я проверил свой код
- [ ] Я добавил комментарии к коду
- [ ] Я обновил документацию
- [ ] Мои изменения не генерируют новых предупреждений
```

### Процесс ревью

- Будьте терпеливы, ревью может занять время
- Отвечайте на комментарии конструктивно
- Вносите изменения по запросу ревьюеров
- Благодарите ревьюеров за их время

## Дополнительные ресурсы

- [FastAPI документация](https://fastapi.tiangolo.com/)
- [SQLAlchemy документация](https://docs.sqlalchemy.org/)
- [Pydantic документация](https://docs.pydantic.dev/)
- [React документация](https://react.dev/)

